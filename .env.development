// File: celtic_calendar/vite.config.js
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

const API_URL = process.env.VITE_API_BASE || "http://localhost:3000";

export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      "/api": {
        target: API_URL,
        changeOrigin: true,
      },
      "/dynamic-moon-phases": { target: API_URL, changeOrigin: true },
      "/healthz":             { target: API_URL, changeOrigin: true },
    },
  },
});


// File: celtic_calendar/src/utils/api.js
const RAW_BASE = (import.meta.env.VITE_API_BASE || "").replace(/\/$/, "");
// If RAW_BASE is empty, use the current origin so relative paths work in dev with Vite's proxy
const API_BASE = RAW_BASE || (typeof window !== "undefined" ? window.location.origin : "");
if (!RAW_BASE && import.meta.env.DEV) {
  console.warn('[LunarAlmanac] VITE_API_BASE is empty; using same-origin with Vite proxy.');
}

function url(path, params) {
  // Build a fully qualified URL against API_BASE (or current origin in dev)
  const u = new URL(path, API_BASE);
  if (params) {
    for (const [k, v] of Object.entries(params)) {
      if (v !== undefined && v !== null && v !== "") u.searchParams.set(k, v);
    }
  }
  return u.toString();
}

// ... rest of the file unchanged ...